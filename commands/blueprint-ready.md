---
name: blueprint-ready
description: 檢查藍圖狀態，顯示進度，建議下一步該執行哪個階段。當想知道目前進度、或不確定下一步該做什麼時使用。
---

# Blueprint Ready - 檢查狀態

分析目前的藍圖進度，判斷哪些階段已完成、哪個階段該進行，並提供明確的下一步建議。

## 核心邏輯

1. **載入藍圖**
   - 檢查 `.blueprint/blueprint.md` 是否存在
   - 找不到 → 檢查 `suspended/` → 列出暫停的藍圖或提示建立新藍圖
   - 讀取藍圖類型、建立時間

2. **解析狀態與依賴**
   - 階段狀態：`Pending` / `In Progress` / `Done` / `Blocked`
   - 計算統計：總數、完成數、進行中、待執行
   - 檢查依賴關係：解析「依賴」欄位，標記被阻塞的階段

3. **複雜度分析**（針對下一個可執行階段）
   - 簡單：產出 ≤ 3 項、目標 < 50 字、無 ⚠️ 標記
   - 複雜：產出 > 5 項、或目標含多個「和/以及」、或有 ⚠️ 標記
   - 中等：不符合以上條件

4. **判斷下一步**（情況 A-D）
   - A：所有完成 → 提示歸檔
   - B：有進行中 → 提示繼續
   - C：有可執行 → 根據複雜度提供建議（簡單/中等/複雜）
   - D：被阻塞 → 說明原因並建議先完成依賴

5. **顯示報告**
   - 進度條：`███░░ 3/5 (60%)`
   - 階段清單（圖示：✓ → ⚠️ 🔄）
   - 建議行動（根據情況）

## 輸出格式

### 找不到藍圖時

**有暫停的藍圖**：
```
❌ 目前沒有進行中的藍圖

暫停中的藍圖 ([數量])：
1. [類型] [功能名稱] (暫停於 [日期])
2. ...

選項：
A. 恢復暫停的藍圖 - 回覆「恢復 1」或執行 /blueprint-resume
B. 開始新的藍圖 - 執行 /blueprint-feat "功能描述"
```

**無暫停的藍圖**：
```
❌ 找不到進行中的藍圖

請先建立藍圖：
- /blueprint-feat "功能描述" - 建立功能開發藍圖
```

### 完整報告格式

```markdown
## Blueprint 狀態報告

**藍圖**：[功能名稱]
**建立時間**：[YYYY-MM-DD]
**進度**：███░░ 3/5 (60%)

### 階段清單

✓ 階段 1: [名稱] - Done
✓ 階段 2: [名稱] - Done
→ 階段 3: [名稱] - Pending (建議下一步)
  階段 4: [名稱] - Blocked (等待階段3)
  階段 5: [名稱] - Pending

圖示：✓ 完成 | → 建議下一步 | ⚠️ 被阻塞 | 🔄 進行中

---

### 建議行動

[根據情況提供具體建議]
```

### 情況 A：所有階段完成

```
🎉 藍圖已全部完成！

接下來要歸檔這個藍圖嗎？回覆「歸檔」我會自動處理。
格式：{建立日期}-{類型}-{slug}
```

### 情況 B：有進行中的階段

```
→ 階段 [N] 進行中：[名稱]
目標：[階段目標]
預期產出：[列表]

建議：繼續完成此階段，完成後更新狀態為 Done
```

### 情況 C：有可執行的階段

```
建議開始：階段 [N] - [名稱]
目標：[一句話]
複雜度：[簡單 ✓ / 中等 / 高 ⚠️]
依賴：[無 或 階段 M]
預期產出：[列表]

[如果複雜度高]
⚠️ 複雜階段，建議拆分（[N]-1, [N]-2...）或開啟新藍圖

◆ 直接開始：回覆「開始階段 [N]」→ 自動更新狀態
◆ 建立任務 (beads)：回覆「建立任務」→ 建立 issue 並記錄 ID
```

### 情況 D：下一階段被阻塞

```
⚠️ 階段 [N] 被阻塞
原因：階段 [M] 未完成（目前：Pending）
建議：先完成階段 [M]，或調整階段順序
```

## AI 主動協助

### 歸檔/廢棄藍圖

**觸發**：使用者說「歸檔」、「廢棄」或類似訊息

**執行**：
1. 讀取藍圖資訊（功能名稱、建立時間、類型）
2. 更新狀態為 "Completed" 或 "Abandoned"
3. 使用資料夾結構歸檔（見 `guides/COMMON_PATTERNS.md#歸檔資料夾結構`）
4. 廢棄時詢問原因並記錄

### Beads 整合

**前置檢查**：見 `guides/COMMON_PATTERNS.md` > Beads 錯誤處理 > Beads 整合狀態檢查

**主要操作**：
- 建立 issue：使用者說「建立任務」→ 執行 bd create 並記錄 ID
- 同步狀態：階段完成時關閉 issue、開始時更新為 in_progress
- 詳細邏輯見 `guides/BEADS_INTEGRATION.md`

### 更新階段狀態

AI 應主動偵測並協助更新狀態：

**時機 1：開始階段**
- 偵測：「開始階段 N」、「我要做階段 N 了」
- 行動：確認後更新 `Pending` → `In Progress`（不記錄）

**時機 2：完成階段**
- 偵測：「完成了」、「階段 N 完成了」
- 行動：確認後更新 `In Progress` → `Done` + 記錄完成內容

**時機 3：明確指示**
- 偵測：「更新階段 N 為 [狀態]」
- 行動：直接執行（不詢問）

**記錄規則**：
- Pending → In Progress：只更新狀態，不記錄
- 其他狀態變化：同時更新狀態 + 記錄原因
- 格式：`### [YYYY-MM-DD]` + `- 階段 N 完成：[描述]`

## 注意事項

- 用圖示清楚標示狀態（✓ → ⚠️ 🔄）
- 提供可直接執行的指令
- 複雜階段特別提醒
- Beads 操作失敗不中斷核心流程
