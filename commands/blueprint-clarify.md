---
name: blueprint-clarify
description: 檢查藍圖是否有過於複雜的階段需要標記，確認邊界定義是否清楚。當藍圖建立後需要快速驗證時使用（簡化版，不做過多互動）。
---

# Blueprint Clarify - 檢查藍圖

快速檢查藍圖，標記過於複雜的階段，確認邊界清楚。

## 核心功能（v0.1 簡化版）

這是簡化版，主要做兩件事：
1. **標記複雜階段**：自動偵測並標記需要注意的階段
2. **確認邊界**：檢查「邊界定義」是否清楚

## 執行步驟

1. **載入藍圖**

   - 讀取 `.blueprint/current.md`
   - 如果不存在：
     ```
     ❌ 找不到藍圖檔案
     請先執行 /blueprint-feat "功能描述" 建立藍圖
     ```
   - 從藍圖中讀取類型（從「類型」欄位）
   - 如果狀態是 "Completed"：
     ```
     ⚠️ 這是已完成的藍圖
     是否仍要檢查？(Y/N)
     ```

2. **複雜度檢查**

   對每個階段檢查以下指標：

   **判斷標準（符合任一即標記）**：
   - 預期產出 > 5 個項目
   - 目標描述包含 3 個以上「和」、「以及」、「包含」等連接詞
   - 可行性說明提到 3 個以上不相關的技術或工具
   - 目標描述超過 100 字（中文）或 200 字（英文）

   **標記方式**：
   ```markdown
   ### 階段 N: [名稱]

   - **目標**: ...
   - **⚠️ 複雜度**: 高 - 此階段包含多個子任務
   - **建議**: 執行時考慮建立子藍圖或用 /speckit.specify 細化
   ```

3. **邊界檢查**

   檢查「邊界定義」區塊：

   - ✅ 如果有明確的「包含」和「不包含」清單
   - ⚠️ 如果缺少「不包含」（提醒補充）
   - ⚠️ 如果「包含」項目太抽象（例如「完整的系統」）

4. **依賴關係檢查**

   檢查每個階段的「依賴」欄位：

   **檢查項目**：

   a. **循環依賴**
   - 檢查是否有 A 依賴 B，B 又依賴 A
   - 或更長的循環：A → B → C → A
   - ⚠️ 發現循環依賴時必須修正

   b. **依賴階段存在性**
   - 「依賴: 階段 N」時，檢查階段 N 是否存在
   - ⚠️ 不存在時提示修正

   c. **遺漏的依賴**（根據階段性質判斷）
   - 測試階段標記「無依賴」→ 可能遺漏（測試通常依賴實作）
   - API/邏輯實作標記「無依賴」但有提到「使用資料結構」→ 可能遺漏
   - 整合階段標記「無依賴」→ 可能遺漏（整合通常依賴各模組）
   - ⚠️ 發現可疑時詢問使用者

   d. **不必要的依賴**
   - 文件階段依賴實作階段 → 合理（需要看程式碼）
   - 前端依賴後端 → 可能不必要（可用 mock）
   - 部署依賴測試 → 合理
   - 優化依賴實作 → 合理
   - ⚠️ 發現可以平行時建議移除依賴

   **檢查範例**：
   ```
   ⚠️ 依賴問題：階段 3「測試」標記為「無依賴」

   但測試通常需要實作完成才能進行。
   是否應該依賴階段 2「API 實作」？

   Y - 更新為「依賴: 階段 2」
   N - 保持原樣（可能是 TDD 或測試框架設定）
   ```

5. **簡單互動**（最多 2-3 個問題）

   只針對**關鍵問題**詢問，優先順序：
   1. 循環依賴（必須修正）
   2. 複雜階段標記
   3. 遺漏的依賴
   4. 邊界定義
   5. 不必要的依賴

   **範例問題**：

   **依賴相關**：
   ```
   ⚠️ 循環依賴：階段 2 依賴階段 3，階段 3 依賴階段 2

   這會造成死鎖，必須修正。建議：
   A. 移除階段 2 → 階段 3 的依賴
   B. 移除階段 3 → 階段 2 的依賴
   C. 重新設計階段順序

   請選擇：
   ```

   **複雜度相關**：
   ```
   發現 1 個複雜階段：階段 3 - 實作認證系統

   是否要加上複雜度標記？
   Y - 加上標記和建議
   N - 保持原樣
   ```

   **邊界相關**：
   ```
   「邊界定義」缺少「不包含」清單

   建議補充不做的事項，是否需要協助？
   Y - 根據功能描述建議「不包含」項目
   N - 之後手動補充
   ```

6. **更新藍圖**

   根據使用者回答：
   - 修正循環依賴（如果有）
   - 更新遺漏或不必要的依賴
   - 在複雜階段加上標記
   - 補充邊界定義（如果使用者同意）
   - 在檔案最後加上檢查記錄：

   ```markdown
   ## 檢查記錄

   ### [YYYY-MM-DD HH:MM]

   - 依賴關係：修正階段 3 的循環依賴，新增階段 4 → 階段 2 依賴
   - 複雜階段標記：階段 3
   - 邊界補充：新增「不包含」清單
   ```

7. **輸出摘要**

   ```
   ✓ 藍圖檢查完成

   檢查結果：
   - 複雜階段：1 個（階段 3）
   - 邊界定義：已補充
   - 階段依賴：正常

   ⚠️ 注意：
   階段 3「實作認證系統」較複雜，執行時建議細化

   下一步：
   - /blueprint-ready - 查看狀態並開始實作
   - 手動調整 .blueprint/current.md（如需要）
   ```

## 注意事項

- **保持簡單**：這是簡化版，不做過多互動（最多 2-3 個問題）
- **優先處理阻塞問題**：循環依賴必須修正，其他問題可以接受
- **標記而非拆分**：只標記複雜階段，不強制拆分（避免無止盡的巢狀）
- **使用者決定**：建議為主，使用者可以選擇忽略
- **不改變結構**：不調整階段順序或增減階段（除非修正循環依賴）
