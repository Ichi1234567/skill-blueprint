---
name: blueprint-abandon
description: 廢棄當前進行中的藍圖，移到 abandoned 目錄。當決定不再繼續某個藍圖時使用。
---

# Blueprint Abandon - 廢棄藍圖

將當前進行中的藍圖標記為廢棄，移到 `abandoned/` 目錄。

## 核心功能

- 廢棄當前活躍的藍圖
- 記錄廢棄時間和原因
- 移動到 abandoned 目錄
- 保留所有資訊供日後參考

## 執行步驟

1. **檢查當前藍圖**

   - 檢查 `.blueprint/current.md` 是否存在
   - 如果不存在：
     ```
     ❌ 沒有進行中的藍圖可以廢棄

     目前沒有活躍的藍圖。
     ```

2. **確認廢棄意圖**

   - 讀取藍圖資訊（功能名稱、類型、狀態）
   - 詢問：
     ```
     確定要廢棄這個藍圖嗎？

     藍圖：[功能名稱]
     類型：[類型]
     狀態：[當前狀態]

     ⚠️ 廢棄後藍圖會移到 abandoned/ 目錄，不會再繼續執行。
     ```
   - 如果使用者已經明確說「廢棄藍圖」，可以跳過確認

3. **讀取廢棄原因**

   - 如果使用者在訊息中已經說明原因（例如：「這個功能不做了，發現有更好的方案」），直接使用
   - 如果沒有提到，詢問：「為什麼要廢棄？（一句話即可，可跳過）」
   - 如果使用者跳過，原因留空（但保留欄位）

4. **讀取藍圖資訊**

   - 從藍圖檔案讀取：功能名稱、建立時間、類型
   - 當前日期作為廢棄日期

5. **更新藍圖狀態**

   - 使用 Edit 工具更新藍圖：
     - 將「狀態」改為 "Abandoned"
     - 在「狀態」後面加上：
       ```markdown
       **廢棄時間**: 2025-12-24
       **廢棄原因**: [使用者提供的原因或留空]
       ```
   - 有原因的格式：
     ```markdown
     **狀態**: Abandoned
     **廢棄時間**: 2025-12-24
     **廢棄原因**: 發現有更好的解決方案
     ```
   - 沒有原因的格式（保留空欄位）：
     ```markdown
     **狀態**: Abandoned
     **廢棄時間**: 2025-12-24
     **廢棄原因**:
     ```

6. **生成廢棄檔名**

   - 格式：`{廢棄日期}-{類型}-{slug}.md`
   - slug 生成規則（**含安全檢查**）：
     - 從功能名稱轉換
     - **安全性**：移除路徑分隔符（`/`、`\`）和路徑遍歷（`..`）
     - 轉小寫（中文保留、英文轉小寫）
     - 空格和特殊字元改為 `-`
     - 移除連續的 `-`
     - 移除開頭和結尾的 `-`
     - **限制長度為 30 字元**（保持檔名簡潔可辨識）
   - 範例：
     - "OAuth 整合" → "oauth-整合"
     - "User Authentication" → "user-authentication"

7. **執行廢棄**

   - 確保 `.blueprint/abandoned/` 目錄存在：
     ```bash
     mkdir -p .blueprint/abandoned || { echo "❌ 建立目錄失敗：請檢查檔案權限"; exit 1; }
     ```
   - 移動檔案（含錯誤處理）：
     ```bash
     mv .blueprint/current.md .blueprint/abandoned/{檔名} || { echo "❌ 廢棄失敗：無法移動檔案"; exit 1; }
     ```
   - 回報：
     ```
     ✓ 藍圖已廢棄

     檔案：.blueprint/abandoned/{檔名}
     類型：{類型}
     功能：{功能名稱}
     廢棄原因：{原因}

     已移除進行中的藍圖，可以開始新的藍圖了。
     ```

## 範例 1：訊息中包含原因

使用者說「這個功能不做了，發現有更好的解決方案」：

```
確定要廢棄「OAuth 整合」藍圖嗎？

讀取藍圖資訊...
廢棄原因：發現有更好的解決方案
生成檔名：2025-12-24-feat-oauth-整合.md

✓ 藍圖已廢棄

檔案：.blueprint/abandoned/2025-12-24-feat-oauth-整合.md
類型：功能開發 (feat)
功能：OAuth 整合
廢棄原因：發現有更好的解決方案

已移除進行中的藍圖，可以開始新的藍圖了。
```

## 範例 2：執行指令後詢問原因

使用者執行 `/blueprint-abandon`：

```
確定要廢棄「OAuth 整合」藍圖嗎？

藍圖：OAuth 整合
類型：功能開發 (feat)
狀態：In Progress

⚠️ 廢棄後藍圖會移到 abandoned/ 目錄，不會再繼續執行。
```

使用者確認後：

```
可以簡單說明一下為什麼要廢棄嗎？（會記錄在藍圖中）
```

使用者回覆：「現有的 library 不支援我們需要的功能」

```
✓ 藍圖已廢棄

檔案：.blueprint/abandoned/2025-12-24-feat-oauth-整合.md
類型：功能開發 (feat)
功能：OAuth 整合
廢棄原因：現有的 library 不支援我們需要的功能

已移除進行中的藍圖，可以開始新的藍圖了。
```

## 廢棄後的藍圖格式

```markdown
# Blueprint: OAuth 整合

**建立時間**: 2025-12-15
**類型**: feat
**狀態**: Abandoned
**廢棄時間**: 2025-12-24
**廢棄原因**: 發現有更好的解決方案

**關聯資訊**:
- Git Branch: feature/oauth
- Beads Issues: beads-145

## 功能描述
...

## 階段規劃
[原本的規劃保持不變，包含已完成的階段進度]
```

## 注意事項

- 廢棄會將狀態改為 "Abandoned"
- 廢棄原因是必填的，方便日後回顧
- 所有階段進度和關聯資訊都會保留
- 檔名中的日期是「廢棄日期」而非「建立日期」
- 廢棄的藍圖存放在 `abandoned/` 目錄，與完成的（`archive/`）和暫停的（`suspended/`）分開
- 廢棄是不可逆的操作（雖然檔案還在，但不建議恢復廢棄的藍圖）
